import{_ as y,a as v,W as S,v as f,o as h,c as C,b as r,w as i,d as p,r as g,h as m,e as d,t as w,i as a,x as P,g as M}from"./entry-e0f1e041.mjs";import{u as I}from"./cookie-3eb92dae.mjs";const D={setup(){return{API:v().API_LINK}},data(){return{web3:null,unsupportPop:!1,applicationServerPublicKey:"BMNjIo94vPi5vc43dJVaAtvEKgL1B78GO27yLi7n-3LWkm7wFcbtZqKoBVCRpC5izpmrksTmHoz_yQAq6JWKGIU",swRegistration:null,pushDetail:null,isMobile:null}},beforeMount(){this.unsupportPop=window.Notification.permission==="denied",this.isMobile=!!/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)},mounted(){this.notificationDB(),this.sendPopUpDB(),"serviceWorker"in navigator&&"PushManager"in window&&"Notification"in window?(console.log("Service Worker and Push is supported"),navigator.serviceWorker.register("./sw.js",{scope:"./"}).then(e=>{console.log("Service Worker is registered",e),this.swRegistration=e,this.swRegistration.pushManager.getSubscription().then(o=>{})}).catch(e=>{console.error("Service Worker Error",e)})):console.warn("Push/Notification messaging is not supported")},methods:{urlB64ToUint8Array(e){const o="=".repeat((4-e.length%4)%4),l=(e+o).replace(/\-/g,"+").replace(/_/g,"/"),c=window.atob(l),s=new Uint8Array(c.length);for(let t=0;t<c.length;++t)s[t]=c.charCodeAt(t);return s},subscribe(){const e=this.urlB64ToUint8Array(this.applicationServerPublicKey);this.swRegistration.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:e}).then(o=>{this.pushDetail=o}).catch(o=>{console.log("Failed to subscribe the user: ",o)})},async loginWC(){if("serviceWorker"in navigator&&"PushManager"in window&&"Notification"in window)this.subscribe();else return;let e=new S({rpc:{1:"https://cloudflare-eth.com"}});await e.enable().catch(l=>e=null),this.web3=new f(e);let o=JSON.parse(localStorage.getItem("walletconnect")===null?null:localStorage.getItem("walletconnect"));if(o!==null&&o.connected===!0){const l=o.accounts[0].toLowerCase(),c=Date.now().toString(),s=`Message: Let's confirm you are the wallet owner.

This request will not trigger a blockchain transaction or cost any gas fees.

Epoch: ${c}`,t=await e.send({method:"personal_sign",params:[s,l,c]});fetch(this.API+"/user/login",{method:"POST",headers:{Accept:"*/*","Content-Type":"application/json"},body:JSON.stringify({sig:t,msg:s,endpoint:this.pushDetail.endpoint,keys:{p256dh:this.pushDetail.toJSON().keys.p256dh,auth:this.pushDetail.toJSON().keys.auth}}),mode:"cors",credentials:"include"}).then(n=>n.json()).then(n=>{Object.keys(n).length!==0?(localStorage.setItem("alertSetting",n.alertSetting),localStorage.setItem("config",n.config),localStorage.setItem("blockHistory",n.blockHistory),localStorage.removeItem("metamask"),this.$router.push({name:"home"})):localStorage.removeItem("walletconnect")}).catch(n=>console.warn(n))}},async loginMetaMask(){if("serviceWorker"in navigator&&"PushManager"in window&&"Notification"in window)this.subscribe();else return;if(typeof window.ethereum!="undefined"){const e=await window.ethereum.request({method:"eth_requestAccounts"});this.web3=new f(window.ethereum);const o=e[0].toLowerCase(),l=Date.now().toString(),c=`Message: Let's confirm you are the wallet owner.

This request will not trigger a blockchain transaction or cost any gas fees.

Epoch: ${l}`,s=await window.ethereum.request({method:"personal_sign",params:[c,o,l]});fetch(this.API+"/user/login",{method:"POST",headers:{Accept:"*/*","Content-Type":"application/json"},body:JSON.stringify({sig:s,msg:c,endpoint:this.pushDetail.endpoint,keys:{p256dh:this.pushDetail.toJSON().keys.p256dh,auth:this.pushDetail.toJSON().keys.auth}}),mode:"cors",credentials:"include"}).then(t=>t.json()).then(t=>{Object.keys(t).length!==0?(localStorage.setItem("alertSetting",t.alertSetting),localStorage.setItem("config",t.config),localStorage.setItem("blockHistory",t.blockHistory),localStorage.setItem("metamask",e[0]),localStorage.removeItem("walletconnect"),this.$router.push({name:"home"})):localStorage.removeItem("metamask")}).catch(t=>{})}else window.open("https://metamask.io/download/")},openDC(){window.open("https://discord.gg/8nxq8jY5y6")},openTW(){window.open("https://twitter.com/ShogunTools")},notificationDB(){let e=indexedDB.open("notificationdb");e.onerror=function(o){console.log("cannot create notification database")},e.onupgradeneeded=function(o){o.target.result.createObjectStore("notification",{autoIncrement:!0})}},sendPopUpDB(){let e=indexedDB.open("sendPopUpdb");e.onerror=function(o){console.log("cannot create sendPopUp database")},e.onupgradeneeded=function(o){o.target.result.createObjectStore("sendPopUp",{autoIncrement:!0})}}}},N={key:0},W=a("br",null,null,-1),B=a("br",null,null,-1),O=a("img",{height:"80",src:P},null,-1),x=a("h2",null,"Shogun Tools",-1),A=a("br",null,null,-1),j=a("br",null,null,-1),T=a("br",null,null,-1),q=a("br",null,null,-1),J=a("br",null,null,-1),K=d("Discord"),U=d("Twitter"),L=a("br",null,null,-1),V=a("br",null,null,-1);function E(e,o,l,c,s,t){const n=g("v-btn"),u=g("v-col"),_=g("v-row"),b=M,k=g("v-card");return I("auth").value===void 0?(h(),C("div",N,[r(k,{class:"mx-auto align-center justify-center text-center","max-width":"400","min-width":"350"},{default:i(()=>[r(b,null,{default:i(()=>[W,B,O,x,A,r(_,{justify:"center"},{default:i(()=>[s.isMobile?p("",!0):(h(),m(u,{key:0,cols:"10"},{default:i(()=>[r(n,{block:"",variant:"outlined",onClick:t.loginWC},{default:i(()=>[d(w(e.$t("index.loginWC")),1)]),_:1},8,["onClick"])]),_:1})),s.isMobile?p("",!0):(h(),m(u,{key:1,cols:"10"},{default:i(()=>[r(n,{block:"",variant:"outlined",onClick:t.loginMetaMask},{default:i(()=>[d(w(e.$t("index.loginMM")),1)]),_:1},8,["onClick"])]),_:1})),r(u,{cols:"10"},{default:i(()=>[s.isMobile?(h(),m(n,{key:0,block:"",variant:"outlined",onClick:t.loginWC},{default:i(()=>[d(w(e.$t("index.loginMobile")),1)]),_:1},8,["onClick"])):p("",!0)]),_:1})]),_:1}),j,T,q,J,r(_,{justify:"center"},{default:i(()=>[r(u,{cols:"auto"},{default:i(()=>[r(n,{size:"x-small",color:"#7289da","prepend-icon":"mdi-discord",onClick:t.openDC},{default:i(()=>[K]),_:1},8,["onClick"])]),_:1}),r(u,{cols:"auto"},{default:i(()=>[r(n,{size:"x-small",color:"#00acee","prepend-icon":"mdi-twitter",onClick:t.openTW},{default:i(()=>[U]),_:1},8,["onClick"])]),_:1})]),_:1}),L,V]),_:1})]),_:1})])):p("",!0)}var z=y(D,[["render",E]]);export{z as default};
