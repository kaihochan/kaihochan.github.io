import{_ as D,u as T,a as x,o as k,c as S,b as e,w as t,d as P,r as a,g as M,e as r,t as i,k as C,i as y}from"./entry-e0f1e041.mjs";import{u as j}from"./cookie-3eb92dae.mjs";const A={setup(){const l=T(),o=x();return{theme:l,toggleTheme:()=>{l.global.name.value=l.global.current.value.dark?"light":"dark",localStorage.setItem("theme",l.global.name.value)},API:o.API_LINK}},data(){return{enablePop:!1,unsupportPop:!1,linesPop:"one",enableSound:!1,enableWebhook:!1,enableEmail:!1,enableDark:!0,dialogLogout:!1}},beforeMount(){this.enableSound=JSON.parse(localStorage.getItem("enableSound")),this.enablePop=JSON.parse(localStorage.getItem("enablePop")),this.enableWebhook=JSON.parse(localStorage.getItem("enableWebhook")),this.enableEmail=JSON.parse(localStorage.getItem("enableEmail")),this.enableDark=localStorage.getItem("theme")==="dark",this.unsupportPop=window.Notification.permission==="denied",this.linesPop=this.enablePop?"three":"one"},mounted(){navigator.serviceWorker.addEventListener("message",this.listeneraction)},beforeUnmount(){navigator.serviceWorker.removeEventListener("message",this.listeneraction)},methods:{listeneraction(l){if(l.data.gas!=null&&l.data.gas[2]!=null){let o=JSON.parse(localStorage.getItem("tracklist"));Object.keys(o).forEach(d=>{o[d].type==="gas"&&o[d].id===parseInt(l.data.gas[2].id)&&(o[d].select=!1)}),localStorage.setItem("tracklist",JSON.stringify(o))}if(l.data.token!=null&&l.data.token[2]!=null){let o=JSON.parse(localStorage.getItem("tracklist"));Object.keys(o).forEach(d=>{o[d].type==="token"&&o[d].id===parseInt(l.data.token[2].id)&&(o[d].select=!1)}),localStorage.setItem("tracklist",JSON.stringify(o))}},togglePop(){this.enablePop=!this.enablePop,this.linesPop=this.enablePop?"three":"one",this.enablePop?(navigator.serviceWorker.ready.then(l=>{l.active.postMessage({sendPopUp:!0})}),localStorage.setItem("enablePop",JSON.stringify(this.enablePop))):(navigator.serviceWorker.ready.then(l=>{l.active.postMessage({sendPopUp:!1})}),localStorage.setItem("enablePop",JSON.stringify(this.enablePop))),this.sendSettings()},toggleSound(){this.enableSound=!this.enableSound,localStorage.setItem("enableSound",JSON.stringify(this.enableSound)),this.sendSettings()},toggleWebhook(){this.enableWebhook=!this.enableWebhook,localStorage.setItem("enableWebhook",JSON.stringify(this.enableWebhook)),this.sendSettings()},toggleEmail(){this.enableEmail=!this.enableEmail,localStorage.setItem("enableEmail",JSON.stringify(this.enableEmail)),this.sendSettings()},setLang(){localStorage.setItem("locale",this.$i18n.locale),this.sendSettings(!0)},logout(){this.dialogLogout=!1,localStorage.clear(),sessionStorage.clear(),indexedDB.deleteDatabase("notificationdb"),indexedDB.deleteDatabase("sendPopUpdb"),localStorage.setItem("locale",this.$i18n.locale),"serviceWorker"in navigator&&"PushManager"in window&&"Notification"in window&&navigator.serviceWorker.register("./sw.js",{scope:"./"}).then(l=>{l.pushManager.getSubscription().then(o=>{o.unsubscribe()})}).catch(l=>{}),fetch(this.API+"/user/logout",{mode:"cors",credentials:"include"}).then(l=>{this.$router.push({name:"index"})}).catch(l=>{})},sendSettings(l=!1){fetch(this.API+"/config/set",{method:"POST",headers:{Accept:"*/*","Content-Type":"application/json"},body:JSON.stringify({popup:this.enablePop,sound:this.enableSound,webhook:this.enableWebhook,email:this.enableEmail,darkTheme:this.enableDark,...l===!0&&{lang:this.$i18n.locale}}),mode:"cors",credentials:"include"})},setTheme(){this.toggleTheme(),this.sendSettings()}}},B={key:0},z={key:0},H=y("br",null,null,-1),$={key:1},q=r("Webhook"),K={class:"text-red"},R={class:"text-red"};function F(l,o,d,G,n,u){const f=a("v-list-subheader"),h=a("v-checkbox"),m=a("v-list-item-avatar"),c=a("v-list-item-title"),W=a("v-list-item-subtitle"),p=a("v-list-item-header"),g=a("v-list-item"),_=a("v-list"),v=a("v-divider"),E=a("v-switch"),V=a("v-icon"),b=a("v-radio"),O=a("v-radio-group"),w=a("v-card-text"),I=a("v-btn"),J=a("v-card-actions"),N=a("v-card"),L=a("v-dialog"),U=M;return j("auth").value!=null?(k(),S("div",B,[e(U,null,{default:t(()=>[e(N,{class:"mx-auto","max-width":"400"},{default:t(()=>[e(_,{"select-strategy":"multiple"},{default:t(()=>[e(f,null,{default:t(()=>[r(i(l.$t("setting.alertSetting")),1)]),_:1}),e(g,{onClick:u.togglePop,lines:n.linesPop,disabled:n.unsupportPop},{default:t(()=>[e(m,{start:""},{default:t(()=>[e(h,{modelValue:n.enablePop,"onUpdate:modelValue":o[0]||(o[0]=s=>n.enablePop=s),color:"primary","hide-details":"",disabled:n.unsupportPop},null,8,["modelValue","disabled"])]),_:1}),e(p,null,{default:t(()=>[e(c,null,{default:t(()=>[r(i(l.$t("setting.popup")),1)]),_:1}),e(W,null,{default:t(()=>[n.enablePop?(k(),S("span",z,[r(i(l.$t("setting.requiresPermission")),1),H,r(i(l.$t("setting.appleUnavaliable")),1)])):P("",!0),n.unsupportPop?(k(),S("span",$,i(l.$t("setting.turnOnPermission")),1)):P("",!0)]),_:1})]),_:1})]),_:1},8,["onClick","lines","disabled"]),e(g,{onClick:u.toggleSound},{default:t(()=>[e(m,{start:""},{default:t(()=>[e(h,{modelValue:n.enableSound,"onUpdate:modelValue":o[1]||(o[1]=s=>n.enableSound=s),color:"primary","hide-details":""},null,8,["modelValue"])]),_:1}),e(p,null,{default:t(()=>[e(c,null,{default:t(()=>[r(i(l.$t("setting.sound")),1)]),_:1})]),_:1})]),_:1},8,["onClick"]),e(g,{onClick:u.toggleEmail},{default:t(()=>[e(m,{start:""},{default:t(()=>[e(h,{modelValue:n.enableEmail,"onUpdate:modelValue":o[2]||(o[2]=s=>n.enableEmail=s),color:"primary","hide-details":""},null,8,["modelValue"])]),_:1}),e(p,null,{default:t(()=>[e(c,null,{default:t(()=>[r(i(l.$t("setting.email")),1)]),_:1})]),_:1})]),_:1},8,["onClick"]),e(g,{onClick:u.toggleWebhook},{default:t(()=>[e(m,{start:""},{default:t(()=>[e(h,{modelValue:n.enableWebhook,"onUpdate:modelValue":o[3]||(o[3]=s=>n.enableWebhook=s),color:"primary","hide-details":""},null,8,["modelValue"])]),_:1}),e(p,null,{default:t(()=>[e(c,null,{default:t(()=>[q]),_:1})]),_:1})]),_:1},8,["onClick"])]),_:1}),e(v),e(_,{"select-strategy":"multiple","active-color":"transparent"},{default:t(()=>[e(f,null,{default:t(()=>[r(i(l.$t("setting.uiSetting")),1)]),_:1}),e(g,null,{default:t(()=>[e(m,{start:""},{default:t(()=>[e(E,{modelValue:n.enableDark,"onUpdate:modelValue":o[4]||(o[4]=s=>n.enableDark=s),color:"primary","hide-details":"",onChange:o[5]||(o[5]=s=>u.setTheme())},null,8,["modelValue"])]),_:1}),e(p,null,{default:t(()=>[e(c,null,{default:t(()=>[r(i(l.$t("setting.darkMode")),1)]),_:1})]),_:1})]),_:1})]),_:1}),e(v),e(_,null,{default:t(()=>[e(f,null,{default:t(()=>[e(V,{icon:"mdi-earth"}),r(" "+i(l.$t("setting.langSetting")),1)]),_:1}),e(g,null,{default:t(()=>[e(O,{column:"",mandatory:"","hide-details":"",modelValue:l.$i18n.locale,"onUpdate:modelValue":o[6]||(o[6]=s=>l.$i18n.locale=s),onChange:u.setLang},{default:t(()=>[e(b,{label:"English",value:"en",color:"primary"}),e(b,{label:"\u65E5\u672C\u8A9E",value:"ja",color:"primary"}),e(b,{label:"\u7E41\u9AD4\u4E2D\u6587",value:"zhHant",color:"primary"}),e(b,{label:"\u7B80\u4F53\u4E2D\u6587",value:"zhHans",color:"primary"})]),_:1},8,["modelValue","onChange"])]),_:1})]),_:1}),e(v),e(_,null,{default:t(()=>[e(g,{color:"red",onClick:o[7]||(o[7]=C(s=>n.dialogLogout=!0,["stop"]))},{default:t(()=>[e(m,{start:""},{default:t(()=>[e(V,{icon:"mdi-logout",color:"red"})]),_:1}),e(c,null,{default:t(()=>[y("span",K,i(l.$t("setting.logout")),1)]),_:1})]),_:1})]),_:1}),e(L,{modelValue:n.dialogLogout,"onUpdate:modelValue":o[10]||(o[10]=s=>n.dialogLogout=s),"max-width":"400","retain-focus":""},{default:t(()=>[e(N,{class:"mx-auto text-center","min-width":"350"},{default:t(()=>[e(w,null,{default:t(()=>[r(i(l.$t("setting.askLogout")),1)]),_:1}),e(J,null,{default:t(()=>[e(I,{class:"mx-auto text-center",onClick:o[8]||(o[8]=s=>u.logout())},{default:t(()=>[y("span",R,i(l.$t("setting.yes")),1)]),_:1}),e(I,{class:"mx-auto text-center",onClick:o[9]||(o[9]=C(s=>n.dialogLogout=!1,["stop"]))},{default:t(()=>[r(i(l.$t("setting.no")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})])):P("",!0)}var Y=D(A,[["render",F]]);export{Y as default};
